{{- with resources.Get .script -}}
  {{- $targetPath := $.script | replaceRE `\.(ts|tsx|jsx)$` ".js" -}}
  {{- $opts := dict
    "minify" (not hugo.IsDevelopment)
    "sourceMap" (cond $.inline "" (cond hugo.IsDevelopment "external" ""))
    "targetPath" (cond $.inline "" $targetPath)
  -}}
  {{- $opts = merge $opts ($.options | default dict) -}}
  {{- with . | js.Build $opts -}}
    {{- if $.inline -}}
      {{ "<script>" | safeHTML }}{{ .Content | safeHTML }}{{ "</script>" | safeHTML }}
    {{- else if hugo.IsDevelopment -}}
      <script type="module" src="{{ .RelPermalink }}"></script>
    {{- else -}}
      {{- with . | fingerprint -}}
        <script
          type="module"
          src="{{ .RelPermalink }}"
          integrity="{{ .Data.Integrity }}"
          crossorigin="anonymous"
        ></script>
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
